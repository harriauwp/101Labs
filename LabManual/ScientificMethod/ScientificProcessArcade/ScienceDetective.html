<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Scientific Process Adventure: Magnesium & Diabetes</title>
<style>
    :root {
        --bg: #0b1020;
        --card: #151a30;
        --accent: #ffb347;
        --accent2: #4fd1c5;
        --accent3: #90cdf4;
        --text: #f7fafc;
        --muted: #a0aec0;
        --danger: #f56565;
        --success: #48bb78;
    }
    * { box-sizing: border-box; }
    body {
        margin: 0;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: radial-gradient(circle at top, #1a2238 0, #050814 55%, #01010a 100%);
        color: var(--text);
    }
    a { color: var(--accent2); }

    .app {
        max-width: 1100px;
        margin: 0 auto;
        padding: 24px 16px 40px;
    }

    h1, h2, h3 {
        margin: 0 0 12px;
        font-weight: 700;
    }
    h1 span.accent { color: var(--accent); }
    p { margin: 0 0 10px; }

    .flex {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
    }
    .center { text-align: center; }

    .card {
        background: linear-gradient(135deg, rgba(255,255,255,0.04), rgba(0,0,0,0.5));
        border-radius: 16px;
        padding: 18px 20px;
        box-shadow: 0 18px 40px rgba(0,0,0,0.55);
        border: 1px solid rgba(255,255,255,0.04);
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }

    .pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        background: rgba(15,118,110,0.16);
        color: var(--accent2);
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.06em;
    }

    .btn {
        border: none;
        cursor: pointer;
        border-radius: 999px;
        padding: 10px 18px;
        font-size: 14px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        transition: transform 0.08s ease, box-shadow 0.1s ease, background 0.15s ease;
        background: linear-gradient(135deg, #ffb347, #ff7b72);
        color: #1a202c;
        box-shadow: 0 10px 24px rgba(0,0,0,0.45);
    }
    .btn.secondary {
        background: rgba(15,118,110,0.1);
        color: var(--accent2);
        box-shadow: none;
        border: 1px solid rgba(79,209,197,0.4);
    }
    .btn:active {
        transform: translateY(1px) scale(0.99);
        box-shadow: 0 6px 14px rgba(0,0,0,0.4);
    }
    .btn[disabled] {
        opacity: 0.5;
        cursor: default;
        box-shadow: none;
    }

    .tagline {
        font-size: 15px;
        color: var(--muted);
        max-width: 620px;
        margin: 8px auto 16px;
    }

    .choice-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 18px;
        margin-top: 14px;
    }

    .experiment-card {
        cursor: pointer;
        transition: transform 0.12s ease, box-shadow 0.12s ease, border-color 0.12s ease;
        border-radius: 18px;
        padding: 16px 18px 18px;
        background: radial-gradient(circle at top left, rgba(255,180,120,0.12), transparent 55%);
        border: 1px solid rgba(255,255,255,0.06);
    }
    .experiment-card.diabetes {
        background: radial-gradient(circle at top left, rgba(144,205,244,0.13), transparent 55%);
    }
    .experiment-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 16px 34px rgba(0,0,0,0.6);
        border-color: rgba(255,255,255,0.18);
    }

    .badge-row {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        margin-top: 8px;
        font-size: 11px;
        color: var(--muted);
    }
    .badge {
        padding: 3px 8px;
        border-radius: 999px;
        border: 1px solid rgba(160,174,192,0.35);
        background: rgba(15,23,42,0.65);
    }

    .hidden { display: none !important; }

    .step-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
    }
    .step-title {
        font-size: 18px;
        font-weight: 600;
    }
    .step-subtitle {
        font-size: 13px;
        color: var(--muted);
    }

    .progress-bar {
        width: 100%;
        height: 6px;
        border-radius: 999px;
        background: rgba(148,163,184,0.25);
        overflow: hidden;
        margin: 10px 0 16px;
    }
    .progress-fill {
        height: 100%;
        width: 0%;
        background: linear-gradient(90deg, #ffb347, #4fd1c5);
        transition: width 0.25s ease-out;
    }

    textarea, input[type="text"] {
        width: 100%;
        background: rgba(15,23,42,0.8);
        border-radius: 10px;
        border: 1px solid rgba(148,163,184,0.6);
        color: var(--text);
        padding: 10px 11px;
        font-size: 14px;
        resize: vertical;
        min-height: 70px;
        outline: none;
    }
    textarea:focus, input[type="text"]:focus {
        border-color: var(--accent2);
        box-shadow: 0 0 0 1px rgba(79,209,197,0.3);
    }

    .prompt-label {
        font-size: 13px;
        font-weight: 600;
        margin-bottom: 6px;
    }
    .prompt-helper {
        font-size: 12px;
        color: var(--muted);
        margin-bottom: 8px;
    }

    .pill-step {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--accent3);
        display: inline-flex;
        gap: 5px;
        align-items: center;
    }

    .nav-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        margin-top: 12px;
        flex-wrap: wrap;
    }

    .feedback {
        font-size: 12px;
        margin-top: 6px;
    }
    .feedback.good { color: var(--success); }
    .feedback.warn { color: var(--danger); }

    .mini-checklist {
        font-size: 12px;
        margin-top: 6px;
        color: var(--muted);
    }
    .mini-checklist span {
        display: inline-block;
        margin-right: 10px;
        padding: 3px 7px;
        border-radius: 999px;
        border: 1px solid rgba(148,163,184,0.5);
    }

    .summary-box {
        font-size: 13px;
        color: var(--muted);
        border-left: 3px solid rgba(144,205,244,0.8);
        padding-left: 10px;
        margin-top: 8px;
    }

    .compare-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 13px;
    }
    .compare-table th,
    .compare-table td {
        border: 1px solid rgba(148,163,184,0.4);
        padding: 6px 8px;
        text-align: left;
    }
    .compare-table th {
        background: rgba(15,23,42,0.8);
        font-weight: 600;
    }
    .compare-table td {
        background: rgba(15,23,42,0.6);
    }

    @media (max-width: 720px) {
        .app { padding: 18px 10px 30px; }
    }
</style>
</head>
<body>
<div class="app">

    <!-- LANDING PAGE -->
    <section id="landing">
        <div class="card center">
            <div class="pill">Interactive PreMed Lab • Scientific Process</div>
            <h1>Build Science Like a <span class="accent">Detective Story</span></h1>
            <p class="tagline">
                Every diagnosis and every experiment starts the same way: an observation, a question,
                and a testable idea. Use two mini “cases”&mdash;magnesium & tomato plants and cinnamon & Type 2 diabetes&mdash;
                to practice the full scientific process from first hunch to theory vs. law.
            </p>
            <div class="flex center" style="justify-content: center; gap: 10px; margin-bottom: 10px;">
                <button class="btn" onclick="scrollToChoices()">
                    Start the Adventure
                </button>
                <button class="btn secondary" onclick="toggleHowTo()">
                    How this game works
                </button>
            </div>
            <div id="howto" class="hidden" style="max-width: 720px; margin: 8px auto 0; text-align: left;">
                <p style="font-size: 13px; color: var(--muted);">
                    1. Pick an experiment: plant nutrition (magnesium) or metabolic health (cinnamon and Type 2 diabetes).<br>
                    2. Move through the steps: observation → curiosity question → research question → hypothesis →
                    prediction → variables → design → results → theory vs. law.<br>
                    3. At each step, type your answer, then use the hints and instant feedback to tighten your scientific thinking.
                </p>
            </div>
            <div class="choice-grid" id="experimentChoices">
                <div class="experiment-card" onclick="startGame('magnesium')">
                    <h3>Magnesium & Tomato Plants</h3>
                    <p style="font-size: 13px; color: var(--muted);">
                        Greenhouse student, two cities, one difference: magnesium in the water.
                        Use plant height and leaf color to build a full experimental story.
                    </p>
                    <div class="badge-row">
                        <div class="badge">Plant physiology</div>
                        <div class="badge">Variables & controls</div>
                        <div class="badge">Quant vs. qual data</div>
                    </div>
                </div>
                <div class="experiment-card diabetes" onclick="startGame('diabetes')">
                    <h3>Cinnamon & Type 2 Diabetes</h3>
                    <p style="font-size: 13px; color: var(--muted);">
                        Clinical team, multiple cinnamon doses, and patients with Type 2 diabetes.
                        Design and interpret a controlled trial on blood glucose and lipids.
                    </p>
                    <div class="badge-row">
                        <div class="badge">Clinical design</div>
                        <div class="badge">Doses & placebos</div>
                        <div class="badge">Biomarkers</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- GAME AREA -->
    <section id="gameSection" class="hidden" style="margin-top: 20px;">
        <div class="card">
            <div class="step-header">
                <div>
                    <div class="pill-step">
                        <span id="expLabel">Magnesium Lab</span>
                        • <span id="stepLabel">Step 1 of 8</span>
                    </div>
                    <div class="step-title" id="stepTitle">Observation</div>
                    <div class="step-subtitle" id="stepSubtitle">
                        Describe what you see before you try to explain it.
                    </div>
                </div>
                <button class="btn secondary" onclick="backToLanding()">← Switch experiment</button>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <!-- Dynamic description / context for chosen experiment -->
            <div id="contextBox" class="summary-box">
                <!-- Filled by JS per experiment + step -->
            </div>

            <!-- Prompt and input -->
            <div style="margin-top: 12px;">
                <div class="prompt-label" id="promptLabel">Your turn</div>
                <div class="prompt-helper" id="promptHelper">
                    Use complete sentences. Focus on what is directly observable.
                </div>
                <textarea id="responseInput" placeholder="Type your response here..."></textarea>
                <div class="feedback" id="feedbackArea"></div>
                <div class="mini-checklist" id="checklistArea"></div>
            </div>

            <!-- Navigation -->
            <div class="nav-row">
                <button class="btn secondary" onclick="prevStep()" id="prevBtn">← Previous</button>
                <div style="flex: 1;"></div>
                <button class="btn" onclick="nextStep()" id="nextBtn">
                    Check & Continue →
                </button>
            </div>
        </div>

        <!-- Comparison / reflection section revealed at final step -->
        <div class="card hidden" id="compareCard" style="margin-top: 16px;">
            <h3>From One Experiment to Medical Science</h3>
            <p style="font-size: 13px; color: var(--muted);">
                Your single experiment is one tile in a much larger mosaic. The table below
                compares how your case fits into different levels of scientific knowledge.
            </p>
            <table class="compare-table">
                <thead>
                    <tr>
                        <th>Level</th>
                        <th>What it is</th>
                        <th>In this module</th>
                    </tr>
                </thead>
                <tbody id="compareBody">
                    <!-- Filled by JS depending on experiment -->
                </tbody>
            </table>
        </div>
    </section>
</div>

<script>
/* ------------ DATA MODEL FOR STEPS ------------ */

const STEPS = [
    "Observation",
    "Curiosity Question",
    "Research Question",
    "Hypothesis",
    "Prediction",
    "Variables & Controls",
    "Experimental Design & Results",
    "Theory vs. Law"
];

const EXPERIMENTS = {
    magnesium: {
        label: "Magnesium & Tomato Plants",
        shortLabel: "Magnesium Lab",
        color: "plants",
        contextByStep: [
            // 0 Observation
            "You are a student working in greenhouses in Racine & Kenosha and you notices that tomato plants in one city grow taller and have thicker stems than in the other. A water filter is used in one greenhouse, while the other uses tap water that contains trace magnesium.",
            // 1 Curiosity
            "Curiosity turns observations into questions. Here you want to know how magnesium in the water might relate to differences in plant growth.",
            // 2 Research Question
            "A research question must be specific and testable. In this case, it should link magnesium concentration (independent variable) to a measurable plant trait such as final height (dependent variable).",
            // 3 Hypothesis
            "A hypothesis is an educated, testable statement. For example, that water containing magnesium will stimulate tomato plants to grow taller compared to water without magnesium.",
            // 4 Prediction
            "A prediction states what should happen if the hypothesis is correct, often in an If–Then form focused on the measurable outcome, such as final plant height.",
            // 5 Variables
            "Here, you identify the independent variable (magnesium in water), the dependent variable (plant height, stem thickness), and control variables (light, temperature, soil, pot size, watering schedule).",
            // 6 Design & Results
            "In the sample design, two groups of tomato plants receive either filtered water (no magnesium) or filtered water plus magnesium salts. All other conditions are kept constant and final heights are measured after several weeks.",
            // 7 Theory vs. Law
            "Your experiment on magnesium contributes one small piece of evidence to a larger theory of plant nutrition supported by many disciplines, but it is far from a universal scientific law."
        ],
        prompts: [
            {
                label: "Describe what you see.",
                helper: "Focus on the differences in tomato plants between the two cities: height, stem thickness, and any leaf color notes; plus, your watering activities.",
                checklist: ["Mentions two locations", "Describes plant differences", "Avoids explanations"]
            },
            {
                label: "Turn that into a curiosity question.",
                helper: "Start with phrases like 'How does…', 'Is there a correlation between…', or 'To what extent…' rather than 'Why…'.",
                checklist: ["Uses How/Is there/To what extent", "Mentions magnesium or water source", "Mentions plant growth"]
            },
            {
                label: "Write a focused research question.",
                helper: "Use the pattern: How does [magnesium concentration] affect [final height of tomato plants]?",
                checklist: ["Mentions magnesium as IV", "Mentions a measurable DV", "Question is testable"]
            },
            {
                label: "Write your hypothesis as a causality statement.",
                helper: "Use the pattern: 'Water containing magnesium will … compared to water without magnesium.'",
                checklist: ["States cause and effect", "Includes comparison group", "Is testable / falsifiable"]
            },
            {
                label: "Write your If–Then prediction.",
                helper: "If [plants receive magnesium water], then [plants will show a specific measurable change].",
                checklist: ["Uses If–Then", "Focuses on measurable outcome", "Aligns with your hypothesis"]
            },
            {
                label: "Identify variables and controls.",
                helper: "Name the independent variable, dependent variable, and at least three factors you would keep constant.",
                checklist: ["Names IV", "Names DV", "Lists ≥ 3 control variables"]
            },
            {
                label: "Sketch the experiment and expected results.",
                helper: "Specify control vs. experimental groups, number of plants per group, and what pattern of results would support vs. reject your hypothesis.",
                checklist: ["Defines groups", "Mentions sample size or replication", "Links expected results to hypothesis"]
            },
            {
                label: "Compare your experiment to theories and laws.",
                helper: "Explain how your single experiment differs in scope, evidence, and certainty from a broader theory of plant nutrition or a physical law.",
                checklist: ["Mentions scope", "Mentions strength of evidence", "Mentions uncertainty / future studies"]
            }
        ],
        compareRows: [
            {
                level: "Hypothesis",
                what: "A narrow, testable idea about how one factor influences another in a specific system.",
                inModule: "Water containing magnesium will stimulate tomato plants to grow taller compared to water without magnesium."
            },
            {
                level: "Scientific Theory",
                what: "A broad explanatory framework supported by many experiments, observations, and disciplines.",
                inModule: "The theory of plant nutrition explains how essential elements like magnesium support photosynthesis, metabolism, and growth across species and environments."
            },
            {
                level: "Scientific Law",
                what: "A mathematical statement describing a consistent relationship between measurable variables.",
                inModule: "Physical laws governing light absorption and energy transfer help explain why chlorophyll with magnesium absorbs light efficiently, but your greenhouse experiment alone does not form a law."
            }
        ]
    },
    diabetes: {
        label: "Cinnamon & Type 2 Diabetes",
        shortLabel: "Diabetes Trial",
        color: "diabetes",
        contextByStep: [
            // 0 Observation
            "Clinicians observe that patients with Type 2 diabetes eating a standard American diet have high blood glucose, blood lipids, and cholesterol. Early studies hint that cinnamon might improve these markers.",
            // 1 Curiosity
            "Curiosity focuses on whether cinnamon intake is linked to changes in metabolic health indicators such as blood glucose or triglycerides.",
            // 2 Research Question
            "A research question must specify cinnamon dose as the independent variable and at least one metabolic marker, such as fasting blood glucose, as the dependent variable.",
            // 3 Hypothesis
            "A hypothesis proposes a causal claim, for example that daily cinnamon consumption will reduce blood glucose levels compared to placebo in adults with Type 2 diabetes.",
            // 4 Prediction
            "A prediction states that if patients consume cinnamon daily, then their blood glucose (and possibly lipids) will decrease more than in a placebo group, in measurable units.",
            // 5 Variables
            "Here, you highlight the independent variable (daily cinnamon dose), dependent variables (blood glucose, lipids, LDL cholesterol), and control variables such as baseline diet instructions, study duration, and age range.",
            // 6 Design & Results
            "In the example design, participants are randomly assigned to placebo or different cinnamon doses (e.g., 1 g, 3 g, 6 g) for 40 days, and before/after values for blood glucose and lipids are recorded and compared.",
            // 7 Theory vs. Law
            "This single clinical trial adds evidence to broader theories of metabolic regulation and diabetes but is only one data point within a much larger literature, not a standalone theory or law."
        ],
        prompts: [
            {
                label: "Describe the starting health picture.",
                helper: "Summarize the blood glucose, lipid, and cholesterol status of patients with Type 2 diabetes before any cinnamon treatment.",
                checklist: ["Mentions Type 2 diabetes", "Mentions high glucose/lipids", "Avoids explanations"]
            },
            {
                label: "Formulate a curiosity question.",
                helper: "Use question stems like 'How does…', 'Is there a correlation between…', or 'To what extent…' focusing on cinnamon intake and metabolic markers.",
                checklist: ["Uses scientific question stem", "Mentions cinnamon", "Mentions at least one metabolic marker"]
            },
            {
                label: "Write a research question.",
                helper: "Use the pattern: How does daily cinnamon consumption affect blood glucose levels in adults with Type 2 diabetes?",
                checklist: ["Mentions cinnamon as IV", "Mentions a clear DV", "Specifies the study population"]
            },
            {
                label: "Write your hypothesis.",
                helper: "Use the pattern: 'Daily cinnamon consumption will … compared to placebo.'",
                checklist: ["States cause and effect", "Includes placebo comparison", "Is testable / falsifiable"]
            },
            {
                label: "Write your If–Then prediction.",
                helper: "If [patients consume cinnamon daily], then [their blood glucose (and/or lipids) will change in a specific direction].",
                checklist: ["Uses If–Then", "Specifies direction of change", "Uses measurable language"]
            },
            {
                label: "Identify variables and controls.",
                helper: "Name the independent variable, dependent variables, and at least three control variables you would keep constant across dosage groups.",
                checklist: ["Names IV", "Names ≥ 1 DV", "Lists ≥ 3 control variables"]
            },
            {
                label: "Outline your clinical design and expected results.",
                helper: "Describe placebo vs. multiple cinnamon doses, sample size per group, duration, and what patterns in before/after data would support vs. reject the hypothesis.",
                checklist: ["Includes placebo and dose groups", "Mentions sample size/time", "Links expected pattern to hypothesis"]
            },
            {
                label: "Contrast your trial with theories and laws.",
                helper: "Discuss how this controlled experiment differs from a broad theory of metabolic regulation or a mathematical law, in scope, evidence, and certainty.",
                checklist: ["Mentions scope", "Mentions strength/amount of evidence", "Mentions uncertainty / need for more trials"]
            }
        ],
        compareRows: [
            {
                level: "Hypothesis",
                what: "A specific, testable claim about how cinnamon intake will change measurable metabolic markers.",
                inModule: "Daily cinnamon consumption will reduce blood glucose levels compared to placebo in adults with Type 2 diabetes."
            },
            {
                level: "Scientific Theory",
                what: "A broad explanation supported by diverse evidence for how hormones, diet, and cellular pathways regulate metabolism.",
                inModule: "The theory of metabolic regulation integrates biochemistry, physiology, genetics, and clinical data to explain Type 2 diabetes and responses to interventions like cinnamon."
            },
            {
                level: "Scientific Law",
                what: "A mathematical relationship between variables that consistently holds under defined conditions.",
                inModule: "Dose–response models for drugs or nutrients can sometimes be expressed in equations, but one cinnamon trial mainly informs the larger theory rather than defining a universal law."
            }
        ]
    }
};

/* ------------ STATE ------------ */

let currentExperiment = "magnesium";
let currentStepIndex = 0;
const responses = {
    magnesium: Array(STEPS.length).fill(""),
    diabetes: Array(STEPS.length).fill("")
};

/* ------------ UI HELPERS ------------ */

function scrollToChoices() {
    document.getElementById("experimentChoices").scrollIntoView({behavior: "smooth", block: "start"});
}

function toggleHowTo() {
    const h = document.getElementById("howto");
    h.classList.toggle("hidden");
}

function backToLanding() {
    document.getElementById("gameSection").classList.add("hidden");
    document.getElementById("landing").scrollIntoView({behavior: "smooth", block: "start"});
}

/* ------------ GAME LOGIC ------------ */

function startGame(expKey) {
    currentExperiment = expKey;
    currentStepIndex = 0;
    document.getElementById("landing").scrollIntoView({behavior: "smooth", block: "start"});
    document.getElementById("gameSection").classList.remove("hidden");
    loadStep();
}

function loadStep() {
    const exp = EXPERIMENTS[currentExperiment];
    const stepName = STEPS[currentStepIndex];

    // Labels
    document.getElementById("expLabel").textContent = exp.shortLabel;
    document.getElementById("stepLabel").textContent = `Step ${currentStepIndex + 1} of ${STEPS.length}`;
    document.getElementById("stepTitle").textContent = stepName;
    document.getElementById("stepSubtitle").textContent = getSubtitle(stepName);

    // Context box
    document.getElementById("contextBox").textContent = exp.contextByStep[currentStepIndex];

    // Prompt / helper / checklist
    const p = exp.prompts[currentStepIndex];
    document.getElementById("promptLabel").textContent = p.label;
    document.getElementById("promptHelper").textContent = p.helper;
    const cl = document.getElementById("checklistArea");
    cl.innerHTML = "";
    p.checklist.forEach(text => {
        const span = document.createElement("span");
        span.textContent = text;
        cl.appendChild(span);
    });

    // Load previous response if any
    const input = document.getElementById("responseInput");
    input.value = responses[currentExperiment][currentStepIndex] || "";
    document.getElementById("feedbackArea").textContent = "";

    // Progress bar
    const fraction = (currentStepIndex) / (STEPS.length - 1);
    document.getElementById("progressFill").style.width = `${fraction * 100}%`;

    // Prev / Next button states
    document.getElementById("prevBtn").disabled = currentStepIndex === 0;
    document.getElementById("nextBtn").textContent =
        currentStepIndex === STEPS.length - 1 ? "Finish & Show Big Picture" : "Check & Continue →";

    // Hide comparison until final step completed
    document.getElementById("compareCard").classList.add("hidden");
}

function getSubtitle(stepName) {
    switch (stepName) {
        case "Observation":
            return "Describe what is happening before you try to explain why.";
        case "Curiosity Question":
            return "Turn your observation into a clear, non‑'why' question.";
        case "Research Question":
            return "Refine curiosity into a specific, testable question with clear variables.";
        case "Hypothesis":
            return "Propose an educated, falsifiable answer to your research question.";
        case "Prediction":
            return "State what you expect to measure if your hypothesis is correct.";
        case "Variables & Controls":
            return "Separate the factor you change from what you measure and what you hold constant.";
        case "Experimental Design & Results":
            return "Plan the test and connect expected data patterns back to your hypothesis.";
        case "Theory vs. Law":
            return "Place your experiment on the hypothesis–theory–law spectrum.";
        default:
            return "";
    }
}

function prevStep() {
    if (currentStepIndex === 0) return;
    saveCurrentResponse();
    currentStepIndex--;
    loadStep();
}

function nextStep() {
    // Save and give simple heuristic feedback
    saveCurrentResponse();
    giveFeedback();

    // If last step, reveal comparison table instead of moving further
    if (currentStepIndex === STEPS.length - 1) {
        fillCompareTable();
        document.getElementById("compareCard").classList.remove("hidden");
        return;
    }
    // Move to next step after brief delay so feedback is visible
    setTimeout(() => {
        currentStepIndex++;
        loadStep();
    }, 500);
}

function saveCurrentResponse() {
    const text = document.getElementById("responseInput").value.trim();
    responses[currentExperiment][currentStepIndex] = text;
}

function giveFeedback() {
    const text = document.getElementById("responseInput").value.toLowerCase();
    const fb = document.getElementById("feedbackArea");
    if (!text) {
        fb.textContent = "Try adding at least one complete sentence before moving on.";
        fb.className = "feedback warn";
        return;
    }

    const stepName = STEPS[currentStepIndex];
    let ok = true;
    let msg = "Nice—this hits the key features of this step. You can refine wording, but the structure is solid.";

    if (stepName === "Observation") {
        if (text.includes("because") || text.includes("due to") || text.includes("cause")) {
            ok = false;
            msg = "Focus on what you see, not why you think it happens. Save explanations for later steps.";
        }
    }
    if (stepName === "Curiosity Question") {
        if (text.startsWith("why")) {
            ok = false;
            msg = "Try rephrasing to start with 'How', 'Is there a correlation between', or 'To what extent' instead of 'Why'.";
        }
    }
    if (stepName === "Hypothesis") {
        if (!text.includes("will")) {
            ok = false;
            msg = "Strong hypotheses usually use a future‑tense verb like 'will' to predict what happens.";
        }
        if (!text.includes("compared")) {
            msg += " Add an explicit comparison phrase (e.g., 'compared to placebo' or 'compared to water without magnesium').";
        }
    }
    if (stepName === "Prediction") {
        if (!text.includes("if")) {
            ok = false;
            msg = "Use an If–Then structure so the prediction clearly follows from your hypothesis.";
        }
    }

    fb.textContent = msg;
    fb.className = "feedback " + (ok ? "good" : "warn");
}

function fillCompareTable() {
    const exp = EXPERIMENTS[currentExperiment];
    const body = document.getElementById("compareBody");
    body.innerHTML = "";
    exp.compareRows.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${row.level}</td>
            <td>${row.what}</td>
            <td>${row.inModule}</td>
        `;
        body.appendChild(tr);
    });
}

/* Initialize default view */
document.addEventListener("DOMContentLoaded", () => {
    // Nothing to do beyond showing landing; gameSection stays hidden
});
</script>
</body>
</html>
